<!doctype html> 
<html> 
<head>
  <title> WebSocket: Echo Server </title>
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
  <link href='http://fonts.googleapis.com/css?family=Lato:400,400italic' rel='stylesheet' type='text/css'>
  <style>
    body {
      font-family: 'Lato';
      font-size: 16px;
      padding: 20px;
    }
  </style>
  <script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
  <script>
  append = function(text){
    document.getElementById("eventi_websocket").insertAdjacentHTML('beforeend', 
    "<li>" + text + ";</li>"
  );
  }
  var cnt = 1;
  var echo_service;

  function websocketConnect(){
    echo_service = new WebSocket('ws://localhost:8080', "echo-protocol");
    echo_service.onmessage = function(event){
      append("messaggio ricevuto"+event.data)
      //echo_service.close();
      res = JSON.parse( event.data );
      append("Valore "+res);
    }
    echo_service.onopen = function(){
      append("connessione effettuata")
      cnt++;
      req = { "module": "moduloram", "num": 200};
      //var j = JSON.stringify([new Number(1)+cnt, new String('false'), new Boolean(false)]);
      var j = JSON.stringify(req);
      // echo_service.send(j);
    }
    echo_service.onclose = function(){
      append("connessione chiusa");
    }
    echo_service.onerror = function(){
      append("errore nella connessione");
    }
  }

  window.onload = websocketConnect()


  $(document).ready(function() {

    $('#reconnbt').click(
            function () {
              websocketConnect()
            });

    $('#sendbt').click(
            function () {
              // $('#id_nocommit').prop('value', "1");
              echo_service.send($('#jsonval').prop('value'));
              ;
            });

    $('pre').click(
            function () {
              $('#jsonval').prop('value', this.innerText)
              echo_service.send($('#jsonval').prop('value'));
            });

  } );
  </script>



</head>
<body>
<div class="container">
  <div class="row">
    <div class="col-md-4">
      <textarea id="jsonval" cols="30" rows="10">asdasd
      </textarea>
      <br><button id="reconnbt" class="bt-primary">Reconnect</button> <button id="sendbt" class="bt-primary">Send</button>
    </div>
    <div class="col-md-4">

      <pre>
{
"module":"moduloram",
"action":"list",
"test":"siii"
}
      </pre>


      </div>
  </div>
</div>

<ul id="eventi_websocket"></ul>

</body> 
</html>
